function jsEncode(a){return encodeURIComponent(a)}function parseQuery(d){var e=new Object();if(!d){return e}var a=d.split(/[;&]/);for(var c=0;c<a.length;c++){var g=a[c].split("=");if(!g||g.length!=2){continue}var b=unescape(g[0]);var f=unescape(g[1]);f=f.replace(/\+/g," ");e[b]=f}return e}function GUID(){var a=function(){return Math.floor(Math.random()*65536).toString(16)};return(a()+a()+""+a()+""+a()+""+a()+""+a()+a()+a())}var polar_login_js_params=parseQuery(document.getElementsByTagName("script")[document.getElementsByTagName("script").length-1].src.replace(/^[^\?]+\??/,""));jQuery.PolarSSO={LOGIN_SERVER:polar_login_js_params.login_server?polar_login_js_params.login_server:"https://www.polar.org.cn/",getUserInfo:function(c,a,b,e){var d={timeout:10000};var c=$.extend({},d,c);$.ajax({type:"GET",url:this.LOGIN_SERVER+"sso_getUserInfo/",dataType:"jsonp",data:"appId="+polar_login_js_params.appId+"&callback=?",timeout:10000,success:function(f){if(f.logined){a(f)}else{b()}},error:function(f){e(f)}})},getUserInfos:function(c,a,b,e){var d={timeout:10000};var c=$.extend({},d,c);$.ajax({type:"GET",url:this.LOGIN_SERVER+"sso_getUserInfos/",dataType:"jsonp",data:"appId="+polar_login_js_params.appId+"&callback=?",timeout:10000,success:function(f){if(f.status=="success"){a(f.staffs)}else{b(f)}},error:function(f){e(f)}})},loginShowPopup:function(d,b,c){var e={timeout:10000};var d=$.extend({},e,d);var a=this.get_hostname(this.LOGIN_SERVER)+(d.lang?"/"+d.lang:"")+"/sso_login/?appId="+polar_login_js_params.appId+"&token="+GUID();this.modalDlg(a,"title",550,500,function(){$.PolarSSO.getUserInfo(d,b,c)})},registerShowPopup:function(d,b,c){var e={timeout:10000};var d=$.extend({},e,d);var a=this.get_hostname(this.LOGIN_SERVER)+(d.lang?"/"+d.lang:"")+"/sso_register/?appId="+polar_login_js_params.appId+"&token="+GUID();this.modalDlg(a,"title",550,500,function(){$.PolarSSO.getUserInfo(d,b,c)})},userInfoShowPopup:function(d,b,c){var e={timeout:10000};var d=$.extend({},e,d);var a=this.get_hostname(this.LOGIN_SERVER)+(d.lang?"/"+d.lang:"")+"/sso_userInfo/?appId="+polar_login_js_params.appId;this.modalDlg(a,"title",550,500,function(){})},userInfoRoleShowPopup:function(d,b,c){var e={timeout:10000};var d=$.extend({},e,d);var a=this.get_hostname(this.LOGIN_SERVER)+(d.lang?"/"+d.lang:"")+"/sso_userInfoRole/?appId="+polar_login_js_params.appId+"&userId="+d.userId;this.modalDlg(a,"title",550,500,function(){$.PolarSSO.getUserInfo(d,b,c)})},logoutAction:function(a,b){$.ajax({type:"GET",url:this.LOGIN_SERVER+"sso_logout/",dataType:"jsonp",data:"callback=?",timeout:10000,success:function(c){if(c.logouted){a(c)}else{b()}},error:function(c){b()}})},userClone:function(c,a,b,e){var d={timeout:10000};var c=$.extend({},d,c);$.ajax({type:"GET",url:this.LOGIN_SERVER+"sso_userClone/",dataType:"jsonp",data:"appId="+polar_login_js_params.appId+"&staffname="+jsEncode(c.staffname)+"&callback=?",timeout:10000,success:function(f){if(f.status=="success"){a(f.userinfo)}else{b(f)}},error:function(f){e(f)}})},userLogin:function(c,a,b,e){var d={timeout:10000};var c=$.extend({},d,c);$.ajax({type:"GET",url:this.LOGIN_SERVER+"sso_userLogin/",dataType:"jsonp",data:"appId="+polar_login_js_params.appId+"&staffname="+jsEncode(c.staffname)+"&password="+jsEncode(c.password)+"&callback=?",timeout:10000,success:function(f){if(f.status=="success"){a(f.userinfo)}else{b(f)}},error:function(f){e(f)}})},modalDlg:function(a,i,b,l,j){if(window.showModalDialog){var g=window.showModalDialog(a+"&ts="+Math.random(),"","dialogWidth:"+b+"px; dialogHeight:"+l+"px; status:no;scrollbars:yes;resizable=yes;");if(g==undefined){g=window.returnValue}j(g)}else{var k=window.screen.width;var f=window.screen.height;var d=(f-l)/2;var e=(k-b)/2;window.myAction=this;var c=window.open(a,"write","top="+d+",left="+e+",width="+b+"px,height="+l+"px,modal=yes,resizable=yes,scrollbars=yes");window.onclick=function(){c.focus()};c.onbeforeunload=function(){j(c.returnValue)}}},get_hostname:function(b){var a=((b||"")+"").match(/^https:\/\/[^/]+/);return a?a[0]:null}};
